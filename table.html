<!doctype html>
<html>
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&amp;display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    <link rel="stylesheet" href="css/common.css">
    <script src="d2data.js"></script>
  </head>
  <body>
    <table>
      <tbody>
        <tr>
          <td>
            <select id="file"></select>
          </td>
        </tr>
      </tbody>
    </table>
    <div id="content"></div>
    <script>
      const version = Diablo2Data.defaultVersion
      const files = [
        "AiParms.txt",
        "Arena.txt",
        "Armor.txt",
        "ArmType.txt",
        "AutoMagic.txt",
        "AutoMap.txt",
        "Belts.txt",
        "BodyLocs.txt",
        "Books.txt",
        "CharStats.txt",
        "CharTemplate.txt",
        "Colors.txt",
        "CompCode.txt",
        "Composit.txt",
        "CubeMain.txt",
        "CubeMod.txt",
        "CubeType.txt",
        "DifficultyLevels.txt",
        "ElemTypes.txt",
        "Events.txt",
        "Experience.txt",
        "Gamble.txt",
        "Gems.txt",
        "HireDesc.txt",
        "Hireling.txt",
        "HitClass.txt",
        "Inventory.txt",
        "ItemRatio.txt",
        "ItemStatCost.txt",
        "ItemTypes.txt",
        "Levels.txt",
        "LowQualityItems.txt",
        "LvlMaze.txt",
        "LvlPrest.txt",
        "LvlSub.txt",
        "LvlTypes.txt",
        "LvlWarp.txt",
        "MagicPrefix.txt",
        "MagicSuffix.txt",
        "MiniSkillIcons.txt",
        "Misc.txt",
        "MissCalc.txt",
        "Missiles.txt",
        "MonAi.txt",
        "MonEquip.txt",
        "MonItemPercent.txt",
        "MonLvl.txt",
        "MonMode.txt",
        "MonName.txt",
        "MonPlace.txt",
        "MonPreset.txt",
        "MonProp.txt",
        "MonSeq.txt",
        "MonSounds.txt",
        "MonStats.txt",
        "MonStats2.txt",
        "MonType.txt",
        "MonUMod.txt",
        "Npc.txt",
        "Objects.txt",
        "ObjGroup.txt",
        "ObjMode.txt",
        "ObjType.txt",
        "Overlay.txt",
        "PetType.txt",
        "PlayerClass.txt",
        "PlrMode.txt",
        "PlrType.txt",
        "Properties.txt",
        "QualityItems.txt",
        "RarePrefix.txt",
        "RareSuffix.txt",
        "Runes.txt",
        "SetItems.txt",
        "Sets.txt",
        "Shrines.txt",
        "SkillCalc.txt",
        "Skilldesc.txt",
        "Skills.txt",
        "SoundEnviron.txt",
        "Sounds.txt",
        "States.txt",
        "StorePage.txt",
        "SuperUniques.txt",
        "TreasureClass.txt",
        "TreasureClassEx.txt",
        "UniqueAppellation.txt",
        "UniqueItems.txt",
        "UniquePrefix.txt",
        "UniqueSuffix.txt",
        "UniqueTitle.txt",
        "WeaponClass.txt",
        "Weapons.txt",
      ]
      const getParameter = key => {
        const params = new URLSearchParams(window.location.search)
        return params.get(key)
      }
      const setParameter = (key, value) => {
        const params = new URLSearchParams(window.location.search)
        if (typeof value !== 'string' || value.length === 0) {
          params.delete(key)
        } else {
          params.set(key, encodeURIComponent(value))
        }
        window.history.replaceState({}, '', `${window.location.pathname}?${params.toString()}${window.location.hash}`)
      }
      const loader = new DataLoader()
      function populate (container) {
        const select = document.querySelector('#file')
        select.innerHTML = ''
        files.forEach(file => {
          const el = document.createElement('option')
          el.textContent = file
          el.value = file
          select.appendChild(el)
        })
        const filename = getParameter('filename')
        if (files.includes(filename)) {
          select.selectedIndex = files.indexOf(filename)
        }
        select.onchange = async e => {
          const filename = select.value
          container.innerHTML = ''
          const raw = await loader.load(version, filename)
          if (filename === select.value) {
            new DataFrameView(raw).populate(container)
            window.table = raw
            setParameter('filename', filename)
          }
        }
        select.onchange()
      }
      async function Load () {
        populate(document.querySelector('#content'))
      }
      requestAnimationFrame(Load)
    </script>
  </body>
</html>
